<project name="processFlowProvision" default="all" >

    <import file="config-build.xml" />
    <import file="classpath-build.xml" />
    
    <target name="clean" description="" >
        <delete dir="${guvnor_repo_location}" />
        <delete dir="${install.home}/tmp" />
        <delete dir="${temp.distro.dir}" />
        <delete dir="${distro.clean}" />
    </target>

    <target name="distro" depends="all" description="" >

        <property name="distro.name" value="processFlow-bin-${brms.major.version}-${brms.minor.version}" />

        <copy file="config-build.xml" tofile="${temp.distro.dir}/build.xml" />
        <copy file="conf/pfp/build.properties" todir="${temp.distro.dir}" />
        <copy file="LICENSE.txt" todir="${temp.distro.dir}" />

        <zip destfile="${install.home}/${distro.name}.zip">
            <zipfileset dir="${temp.distro.dir}" prefix="${distro.name}" />
            <zipfileset dir="bin" prefix="${distro.name}/bin" />
            <zipfileset dir="conf" prefix="${distro.name}/conf"/>
            <zipfileset dir="lib" prefix="${distro.name}/lib"/>
            <zipfileset dir="doc" prefix="${distro.name}/doc">
                <include name="ADMIN_GUIDE.txt" />
                <include name="release_notes.txt" />
            </zipfileset>
        </zip>
    </target>

    <target name="download.drools.guvnor">
        <echo message="Getting Drools Guvnor ..." />
        <get src="${drools.guvnor.url}" dest="${install.home}/lib/guvnor-distribution-wars-${drools.guvnor.version}-jboss-as-7.0.war"  skipexisting="true" />
    </target>
    <target name="download.designer" >
        <get src="${designer.url}/designer-${designer.version}.war" dest="${install.home}/lib/designer-${designer.version}.war"  skipexisting="true" />
    </target>
    <target name="download.jBPM.gwt-console">
        <property name="jBPM.url" value="file://${jbpm.source.dir}/jbpm-distribution/target" />
        <get src="${jBPM.url}/jbpm-${console.server.version}-gwt-console.zip" dest="${install.home}/lib/jbpm-${console.server.version}-gwt-console.zip"  />
    </target>

    <target name="useCompiledJBPMLibs" depends="" if="useCompiledJBPMLibs">
        <echo message="inside useCompiledJBPMLibs" />
        <antcall target="download.drools.guvnor" />
        <antcall target="download.designer" />
        <antcall target="download.jBPM.gwt-console" />
    </target>

    <target name="all" >
        <antcall target="clean" />
        <mkdir dir="${install.home}/lib" />
        <antcall target="stop.jboss" >
            <param name="management.port" value="${brms.webs.management.port}"/>
        </antcall>
        <antcall target="stop.jboss" >
            <param name="management.port" value="${pfp.core.management.port}"/>
        </antcall>
        <antcall target="provision.switchyard.as7" />
        <antcall target="provision.brms.webs" />
        <antcall target="provision.pfp.core" />
        <antcall target="clean.jbpm.install" />
    </target>
</project>
